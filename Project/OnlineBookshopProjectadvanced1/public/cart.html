<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* Updated CSS styles for a tasteful design */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
    }

    header {
      background-color: #0056b3;
      color: #fff;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      margin: 0;
      font-size: 24px;
    }

    a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }

    main {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    button {
      background-color: #0056b3;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }

    .cart-container {
      background-color: #fff;
      padding: 20px;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .book-item {
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 20px;
      background-color: #fff;
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .book-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .book-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .book-quantity {
      font-weight: bold;
    }
  </style>
  <title>Cart</title>
</head>
<body>
  <header>
    <h1>Shopping Cart</h1>
    <a href="customerworkpage.html">Back to Home</a>
  </header>

  <main>
    <div>
      <button id="clearCart">Clear Cart</button>
      <button id="commitorder">Commit Order</button>
    </div>

    <div class="cart-container" id="cartContainer">
      <!-- Book items will be dynamically added here -->
    </div>
  </main>

  <script>
    function clearCart() {
      // Retrieve the customer ID (cid) from local storage
      const cid = localStorage.getItem("cid");

      // Retrieve the customerOrders array from localStorage
      const customerOrders = JSON.parse(localStorage.getItem("customerOrders")) || {};
    
      // Check if the customer's orders exist
      if (customerOrders[cid]) {
        // Clear the customer's orders (set it to an empty array)
        customerOrders[cid] = [];
        
        // Update the customerOrders array in localStorage
        localStorage.setItem("customerOrders", JSON.stringify(customerOrders));
        
        // Remove the items from the cart on the current page
        const cartContainer = document.getElementById("cartContainer");
        cartContainer.innerHTML = ""; // Clear the content of the cart container
        
        console.log("Cart cleared successfully.");
      } else {
        console.log("No items to clear in the cart.");
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const cartContainer = document.getElementById("cartContainer");

      // Retrieve the customer ID (cid) from local storage
      const cid = localStorage.getItem("cid");

      // Retrieve the customerOrders 2D array from local storage
      const customerOrders =
        JSON.parse(localStorage.getItem("customerOrders")) || [];
        console.log(customerOrders);
      // Get the specific customer's orders using the cid
      const specificCustomerOrders = customerOrders[cid] || [];

      // Display book ID and quantity in the cart
      specificCustomerOrders.forEach((order) => {
        const bookItem = document.createElement("div");
        bookItem.className = "book-item";

        const bookInfoElement = document.createElement("div");
        bookInfoElement.className = "book-info";

        const bookDetails = document.createElement("div");
        bookDetails.className = "book-details";

        const bookID = document.createElement("div");
        bookID.className = "book-title";
        bookID.textContent = `Book ID: ${order.bookId}`; // Corrected to access bookId as an object property

        const bookQuantity = document.createElement("div");
        bookQuantity.className = "book-quantity";
        bookQuantity.textContent = `Quantity: ${order.orderedAmount}`; // Corrected to access orderedAmount as an object property

        bookDetails.appendChild(bookID);
        bookDetails.appendChild(bookQuantity);

        bookInfoElement.appendChild(bookDetails);

        bookItem.appendChild(bookInfoElement);
        cartContainer.appendChild(bookItem);
      });

      function isJSONString(str) {
        try {
          JSON.parse(str);
          console.log("Yes");
          return true;
        } catch (e) {
          return false;
        }
      }

      function disableCommitOrderButton() {
        commitOrderButton.disabled = true;
        commitOrderButton.textContent = "Processing...";
      }
    
      // Function to enable the Commit Order button
      function enableCommitOrderButton() {
        commitOrderButton.disabled = false;
        commitOrderButton.textContent = "Commit Order";
      }
      const clearCartButton=document.getElementById("clearCart");
      clearCartButton.addEventListener("click",clearCart);
      const commitOrderButton = document.getElementById("commitorder");
      commitOrderButton.addEventListener("click", () => {
        // Disable the button to prevent multiple submissions
        disableCommitOrderButton();
    
        if (isJSONString(JSON.stringify(customerOrders))) {
          console.log(customerOrders);
          // You can proceed to send it as JSON
          fetch("/sendCustomerOrders", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(customerOrders),
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("Server response:", data);
              // Clear the cart and enable the button after successful submission
              clearCart();
              enableCommitOrderButton();
            })
            .catch((error) =>{
              console.error("Error sending data to the server:", error);
              // Enable the button in case of an error
              enableCommitOrderButton();
            });
        } else {
          // The customerOrders array is not valid JSON
          console.error("customerOrders is not a valid JSON array.");
          // Enable the button
          enableCommitOrderButton();
        }
      });
    });
  </script>
</body>
</html>
